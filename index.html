<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>每日圣经</title>
    <!-- PWA Manifest Link -->
    <link rel="manifest" href="/manifest.json">
    <style>
        /* 全局背景和居中 */
        body { 
            font-family: 'Helvetica Neue', Arial, sans-serif; 
            text-align: center; /* 所有行内元素居中 */
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            background-color: #f0f4f8; 
            color: #333;
        }
        
        /* 容器居中 */
        #verse-container {
            display: flex;
            flex-direction: column;
            align-items: center; /* 块级元素居中 */
            padding-bottom: 20px; /* 移除底部导航栏后的调整 */
        }

        /* 动态标题样式 - 居中（保持不变） */
        #verse-title { 
            font-size: 1.8em; 
            margin-top: 20px; 
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
            text-align: center;
        }

        /* 日期显示样式 - 居中（保持不变） */
        #date-display {
            font-size: 1em; /* 小字 */
            color: #777;
            margin-bottom: 30px; /* 增加空间 */
            font-weight: bold;
            text-align: center;
        }

        /* 经文内容样式 - 居中，无背景 */
        #verse-content {
            font-size: 1.3em; 
            line-height: 1.8; /* 优化可读性 */
            color: #1a1a1a;
            margin-bottom: 25px;
            padding: 0 10px; 
            font-weight: 400;
            text-align: center; /* 居中显示 */
            background: none; /* 移除背景 */
            border: none; /* 移除边框 */
        }

        /* 经文出处样式 - 居中，灰色文字 */
        #verse-ref {
            font-size: 1em;
            color: #666; /* 灰色文字 */
            font-weight: 500;
            margin-bottom: 25px;
            cursor: pointer;
            text-align: center; /* 居中显示 */
        }

        /* 主要内容卡片样式 - 现在只包含经文内容和引用 */
        #daily-card {
            background-color: #ffffff;
            border-radius: 16px;
            padding: 20px 0; /* 调整内边距，因为标题和日期移出去了 */
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            text-align: center; /* 卡片内内容居中 */
            margin-bottom: 30px;
        }
        
        /* 按钮容器 */
        #button-group {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 500px;
            margin-bottom: 30px;
            gap: 15px; /* 增加按钮间距 */
        }

        /* 按钮样式 - 毛玻璃效果 */
        .action-button {
            flex: 1; /* 均分空间 */
            padding: 12px 20px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.8); /* 浅色边框 */
            border-radius: 12px;
            transition: all 0.3s ease;
            
            /* 毛玻璃效果 */
            background-color: rgba(255, 255, 255, 0.6); /* 半透明白色 */
            color: #1a1a1a; /* 深色文字 */
            backdrop-filter: blur(8px); 
            -webkit-backdrop-filter: blur(8px); 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); 
        }

        .action-button:hover {
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        /* 移除原先的固定颜色覆盖 */
        #understandButton, #prayerButton, #consultationButton {
            background-color: initial;
            color: #1a1a1a;
        }

        /* 每日思想/祷告内容样式 */
        #think-content, #prayer-content {
            font-size: 1.0em;
            line-height: 1.8;
            color: #444;
            white-space: pre-wrap; /* 保留换行符和空格 */
        }
        
        /* ---------------- Modal (弹出框) 样式 - 保持上一次的优化 ---------------- */
        
        /* Modal 覆盖层 */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1000; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7); 
            display: flex;
            align-items: center; /* 垂直居中 */
            justify-content: center; /* 水平居中 */
        }

        /* 弹出框内容 */
        .modal-content {
            background-color: #fff;
            padding: 25px;
            border: none;
            width: 90%; 
            max-width: 450px; 
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation-name: animatetop;
            animation-duration: 0.4s;
            max-height: 90vh; /* 限制高度并允许滚动 */
            overflow-y: auto; 
            text-align: left; 
        }

        /* 关闭按钮 */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            line-height: 1; 
            margin-top: -10px; 
            margin-right: -10px;
        }

        .close:hover,
        .close:focus {
            color: #333;
            text-decoration: none;
            cursor: pointer;
        }
        
        /* 模态框头部 */
        .modal-header h2 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #007bff;
            font-size: 1.5em;
            padding-bottom: 5px;
            border-bottom: 2px solid #f0f4f8;
        }

        /* 模态框内容体 */
        .modal-body p {
            margin-top: 0;
            margin-bottom: 15px; 
            line-height: 1.6;
        }
        
        /* 动画效果 */
        @keyframes animatetop {
            from {top: -300px; opacity: 0}
            to {top: 0; opacity: 1}
        }

    </style>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <div id="verse-container">
        
        <!-- 标题和日期移到卡片外面 -->
        <h1 id="verse-title"></h1>
        <div id="date-display"></div>
        
        <div id="daily-card">
            <!-- 经文内容 - 移除 blockquote class -->
            <div id="verse-content">
                正在加载今天的经文...
            </div>
            
            <!-- 经文出处 (可点击) -->
            <div id="verse-ref"></div>
        </div>

        <!-- 理解/祷告/交流 按钮组 -->
        <div id="button-group">
            <button class="action-button" id="understandButton">理解</button>
            <button class="action-button" id="prayerButton">祷告</button>
            <button class="action-button" id="consultationButton">交流</button>
        </div>
        
    </div>

    <!-- ---------------- 弹出框 (Modals) 区域 ---------------- -->

    <!-- 理解 UNDERSTAND 弹出框 (原思想 THINK) -->
    <div id="understandModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" id="closeUnderstand">&times;</span>
            <div class="modal-header">
                <h2>今日理解</h2>
            </div>
            <div class="modal-body">
                <p id="think-content">正在加载理解内容...</p>
            </div>
        </div>
    </div>

    <!-- 祷告 PRAYER 弹出框 -->
    <div id="prayerModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" id="closePrayer">&times;</span>
            <div class="modal-header">
                <h2>祷告指引</h2>
            </div>
            <div class="modal-body">
                <p id="prayer-content">正在加载祷告内容...</p>
            </div>
        </div>
    </div>

    <!-- 交流 CONSULTATION 弹出框 (原联系方式) -->
    <div id="consultationModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" id="closeConsultation">&times;</span>
            <div class="modal-header">
                <h2>交流联系</h2>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 10px;">
                    <strong>邮箱：</strong> juvan0926@gmail.com
                <p style="margin-bottom: 10px;">
                    <strong>微信：</strong> 18968860469
                <p style="margin-bottom: 10px;">
                    <strong>淘宝：</strong> https://m.tb.cn/h.Sr7xvEYKyFQt6jo
                <p style="margin-bottom: 10px;">
                    <strong>小红书：</strong> https://xhslink.com/m/4AgROk2mC4
                </p>

                <p style="font-weight: bold; color: #2196F3; text-align: center;">
                    我们很乐意与您交流和代祷！
                </p>
            </div>
        </div>
    </div>
    
    <!-- 经文出处详情 弹出框 -->
    <div id="referenceModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" id="closeReference">&times;</span>
            <div class="modal-header">
                <h2>经文出处</h2>
            </div>
            <div class="modal-body">
                <p id="full-ref-text">正在加载出处信息...</p>
            </div>
        </div>
    </div>


<script type="module">
    // CSV 数据（这里是示例数据，实际应用中应从外部加载）
    const csvData = [
        // 1
        {
            day: "1",
            title: "主里新身份",
            text: "你看父赐给我们是何等的慈爱！",
            ref: "约翰一书3章1节",
            think: "“我不再是从前的我了，现在的我是新造的人。”这是我儿子杰夫在一次学校集会上，向学生们描述上帝在他生命中的改变。杰夫曾是个海洛因成瘾者，他从前是以所犯的罪和错误来看待自己，但现在他视自己为上帝的儿女。\n\n圣经也用此应许来激励我们：“若有人在基督里，他就是新造的人，旧事已过，都变成新的了”（哥林多后书5章17节）。无论我们曾是怎么样的人，也无论过去曾做过什么，当我们相信耶稣已拯救我们，且接受祂藉着被钉十架所赐的赦免，你我就成为新造的人。自从人类始祖被赶出伊甸园之后，我们的罪使你我与上帝隔离，但如今上帝“藉着基督使我们跟祂和好”，不将我们的过犯“归到”我们身上（18-19节）。我们是祂挚爱的儿女（约翰一书3章1-2节），我们的罪孽被洗净，成为有基督生命的新造之人。\n\n耶稣拯救我们脱离罪，以及罪的权势，使我们与上帝有了新的关系──我们不再为自己而活，乃是为替我们死而复活的主而活（哥林多后书5章15节)。在元旦的这一天，让我们回想上帝那改变生命的爱，激励我们活出新的身份和目标，好叫我们能引导别人认识这位救主，祂能使他们成为新造的人。",
            Prayer: "知道耶稣关注你，如何改变你对自己的看法？\n你周遭有哪些人需要得到关注？\n你如何“停下脚步”，以救主的爱来鼓励他们？\n亲爱的耶稣，感谢祢垂听我的呼求。求祢帮助我，\n如同那位重见光明的瞎子，一生跟随并赞美祢。"
        },
        // 2 (Added a second entry for robustness)
        {
            day: "2",
            title: "恩典的记号",
            text: "我们行事为人是凭着信心，不是凭着眼见。",
            ref: "哥林多后书5章7节",
            think: "一位父亲带着小儿子，坐飞机从美国前往加拿大。当飞机穿过一片厚厚的云层时，小儿子开始感到不安，他问父亲：“我们到哪儿了？我们是不是迷路了？”父亲微笑着指着窗外说：“看，我们已经飞到云层上面了。”小儿子往下一看，只见脚下是一片无边无际的云海，仿佛棉花糖铺成的地毯。他立刻安静了下来，因为他知道，父亲带他走在正确的道路上。\n\n人生也常有‘云层’遮盖，让我们感到迷失和不安。我们看不见前方的路，听不见上帝的声音，甚至怀疑祂是否真的与我们同在。但圣经提醒我们，我们的生命之旅不是凭着眼见，而是凭着信心。信心不是感觉，而是在看不见的时候依然相信上帝的应许。即使我们身处低谷，感受不到上帝的同在，我们仍可以确信祂永不离弃我们，祂的恩典足够我们用。我们行事为人，凭着祂的话语，而不是凭着眼前的环境。今天，当你面对生活中的'云层'时，请紧紧抓住这信心的锚。",
            Prayer: "主啊，感谢祢的应许，即使在困境中，我仍然可以凭着信心前行。求祢坚定我的心，让我不要被眼前的景象所动摇。帮助我学习信靠祢，如同那位紧紧抓住父亲手的孩子。奉主耶稣的名祷告，阿门。"
        }
        // ... more data
    ];
    
    // 获取当天的日期
    function getDayIndex() {
        const startDate = new Date(new Date().getFullYear(), 0, 1);
        const today = new Date();
        const diffTime = today.getTime() - startDate.getTime();
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
        return (diffDays % csvData.length) || csvData.length;
    }

    function getTodaysDateString() {
        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth() + 1;
        const day = today.getDate();
        const week = ["日", "一", "二", "三", "四", "五", "六"][today.getDay()];
        return `${year}年${month}月${day}日 星期${week}`;
    }

    function displayVerse() {
        const dayIndex = getDayIndex();
        const verse = csvData[dayIndex - 1]; // 数组索引从 0 开始

        if (!verse) {
            document.getElementById('verse-content').innerText = "未能找到今天的经文。";
            return;
        }

        document.getElementById('verse-title').innerText = verse.title;
        document.getElementById('date-display').innerText = getTodaysDateString();
        document.getElementById('verse-content').innerText = verse.text;
        document.getElementById('verse-ref').innerText = verse.ref;

        // 填充 Modal 内容
        document.getElementById('think-content').innerText = verse.think;
        document.getElementById('prayer-content').innerText = verse.Prayer;

        // 设置经文出处点击事件
        const verseRefElement = document.getElementById('verse-ref');
        verseRefElement.onclick = function() {
            // 在经文出处弹出框中显示完整的经文出处 (这里简化为显示标题+出处)
            document.getElementById('full-ref-text').innerText = `${verse.title}\n\n出处：${verse.ref}\n\n经文内容：${verse.text}`;
            document.getElementById('referenceModal').style.display = "flex"; // 使用 flex 显示以保持居中
        };
    }
    
    function setupModalListeners() {
        const understandModal = document.getElementById('understandModal'); // 更改 ID
        const prayerModal = document.getElementById('prayerModal');
        const consultationModal = document.getElementById('consultationModal');
        const referenceModal = document.getElementById('referenceModal');

        const understandButton = document.getElementById('understandButton'); // 更改 ID
        const prayerButton = document.getElementById('prayerButton');
        const consultationButton = document.getElementById('consultationButton');

        const closeUnderstand = document.getElementById('closeUnderstand'); // 更改 ID
        const closePrayer = document.getElementById('closePrayer');
        const closeConsultation = document.getElementById('closeConsultation');
        const closeReference = document.getElementById('closeReference');
        
        // 理解功能（显示理解内容弹出框）
        if (understandButton) {
            understandButton.onclick = function() {
                understandModal.style.display = "flex"; 
            }
        }
        
        // 祷告功能（显示祷告指引弹出框）
        if (prayerButton) {
            prayerButton.onclick = function() {
                prayerModal.style.display = "flex"; 
            }
        }
        
        // 交流功能（显示交流弹出框）
        if (consultationButton) {
            consultationButton.onclick = function() {
                consultationModal.style.display = "flex"; 
            }
        }

        // 关闭 UNDERSTAND 弹出框
        if (closeUnderstand) {
            closeUnderstand.onclick = function() {
                understandModal.style.display = "none";
            }
        }

        // 关闭 PRAYER 弹出框
        if (closePrayer) {
            closePrayer.onclick = function() {
                prayerModal.style.display = "none";
            }
        }
        
        // 关闭 CONSULTATION 弹出框
        if (closeConsultation) {
            closeConsultation.onclick = function() {
                consultationModal.style.display = "none";
            }
        }
        
        // 关闭 REFERENCE 弹出框
        if (closeReference) {
            closeReference.onclick = function() {
                referenceModal.style.display = "none";
            }
        }

        // 点击窗口外部关闭所有弹出框
        window.onclick = function(event) {
            if (event.target == understandModal) {
                understandModal.style.display = "none";
            }
            if (event.target == prayerModal) {
                prayerModal.style.display = "none";
            }
            if (event.target == consultationModal) {
                consultationModal.style.display = "none";
            }
            if (event.target == referenceModal) {
                referenceModal.style.display = "none";
            }
        }
        
        // 阻止按钮的默认行为，防止与窗口点击事件冲突
        document.querySelectorAll('.action-button').forEach(button => {
            button.addEventListener('click', (e) => e.stopPropagation());
        });
        
    }
    
    // 主函数调用
    window.onload = function() {
        displayVerse();
        setupModalListeners();
    };

</script>
</body>
</html>
